class combatant{
    constructor(layer,x,y,type,team){
        this.layer=layer
        this.position={x:x,y:y}
        this.type=type
        this.team=team
        this.size=1
		this.flip=1-this.team*2
		this.direction=0
        this.name=types.combatant[this.type].name
        this.alt=types.combatant[this.type].alt
        this.life=types.combatant[this.type].life
		this.height=types.combatant[this.type].height
        this.base={life:this.life,position:{x:this.position.x,y:this.position.y}}
        this.collect={life:this.life}
		this.calc={damage:0}
		this.block=0
		this.fades={block:0,info:0}
        if(this.type==0){
            this.fade=0
        }else{
            this.fade=1
        }
    }
    display(){
        this.layer.translate(this.position.x,this.position.y)
        this.layer.rotate(this.direction)
        this.layer.scale(this.size*this.flip,this.size)
        switch(this.type){
            case 1: case 2:
				this.layer.stroke(80,this.fade)
				this.layer.strokeWeight(4)
				this.layer.line(-4,-30,-8,0)
				this.layer.line(4,-30,8,0)
				this.layer.line(-6,-48,-15,-24)
				this.layer.line(6,-48,15,-24)
				this.layer.noStroke()
				this.layer.fill(80,this.fade)
				this.layer.ellipse(0,-45,18,36)
				this.layer.fill(240,220,180,this.fade)
				this.layer.ellipse(0,-75,30,30)
				this.layer.fill(0,this.fade)
				this.layer.ellipse(4,-72,4,4)
				this.layer.ellipse(12,-72,4,4)
			break
        }
        this.layer.scale(1/this.size/this.flip,1/this.size)
        this.layer.rotate(-this.direction)
        this.layer.translate(-this.position.x,-this.position.y)
    }
    displayInfo(){
        this.layer.translate(this.base.position.x,this.base.position.y)
        this.layer.noStroke()
		this.layer.fill(0,this.fade)
		this.layer.rect(0,20,62,10,4)
		this.layer.fill(150,this.fade)
		this.layer.rect(0,20,60,8,3)
		if(this.collect.life>=this.life){
			this.layer.fill(240,0,0,this.fade)
			this.layer.rect((max(0,this.collect.life)/this.base.life)*30-30,20,(max(0,this.collect.life)/this.base.life)*60,2+min((max(0,this.collect.life)/this.base.life)*90,6),3)
			this.layer.fill(min(255,510-max(0,this.life)/this.base.life*510)-max(0,5-max(0,this.life)/this.base.life*30)*25,max(0,this.life)/this.base.life*510,0,this.fade)
			this.layer.rect((max(0,this.life)/this.base.life)*30-30,20,(max(0,this.life)/this.base.life)*60,2+min((max(0,this.life)/this.base.life)*90,6),3)
        }else if(this.collect.life<this.life){
			this.layer.fill(240,0,0,this.fade)
			this.layer.rect((max(0,this.life)/this.base.life)*30-30,20,(max(0,this.life)/this.base.life)*60,2+min((max(0,this.life)/this.base.life)*90,6),3)
			this.layer.fill(min(255,510-max(0,this.collect.life)/this.base.life*510)-max(0,5-max(0,this.collect.life)/this.base.life*30)*25,max(0,this.collect.life)/this.base.life*510,0,this.fade)
			this.layer.rect((max(0,this.collect.life)/this.base.life)*30-30,20,(max(0,this.collect.life)/this.base.life)*60,2+min((max(0,this.collect.life)/this.base.life)*90,6),3)
		}
		if(this.fades.block>0){
			this.layer.fill(0,this.fade*this.fades.block)
			this.layer.ellipse(-30,20,16,16)
			this.layer.fill(150,175,200,this.fade*this.fades.block)
			this.layer.ellipse(-30,20,14,14)
		}
		this.layer.fill(0,this.fade)
		this.layer.textSize(8)
		this.layer.text(max(0,ceil(this.life*10)/10)+"/"+max(0,ceil(this.base.life)),0,21)
		if(this.fades.block>0){
			this.layer.text(this.block,-30,20)
		}
		this.layer.textSize(10)
		this.layer.text(this.name,0,32)
        if(this.alt!=''){
			this.layer.text(this.alt,0,40)
		}
		this.layer.translate(-this.base.position.x,-this.base.position.y)
    }
	take(damage){
		this.calc.damage=damage
		if(this.block>this.calc.damage){
			this.block-=this.calc.damage
		}else if(this.block>0){
			this.calc.damage-=this.block
			this.block=0
			this.life-=this.calc.damage
		}else{
			this.life-=this.calc.damage
		}
		current.particles.push(new particle(this.layer,this.position.x,this.position.y,0,random(0,360),4,1.5,[255,0,0]))
		current.particles[current.particles.length-1].text=round(damage*10)/10
	}
    update(){
		this.collect.life=this.collect.life*0.9+this.life*0.1
		if(this.fades.block<1&&this.block>0){
			this.fades.block=round(this.fades.block*10+1)/10
		}else if(this.fades.block>0&&this.block<=0){
			this.fades.block=round(this.fades.block*10-1)/10
		}
    }
}